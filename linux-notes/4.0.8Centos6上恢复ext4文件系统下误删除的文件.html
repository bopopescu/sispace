<html>
<head>
  <title>4.0.8Centos6上恢复ext4文件系统下误删除的文件</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308859 (zh-CN, MWS); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1448"/>
<h1>4.0.8Centos6上恢复ext4文件系统下误删除的文件</h1>

<div>
<span><div style="margin: 0mm -13mm 0mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 20pt;"><br/></div><div style="margin: 0mm -13mm 0mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 20pt;"><span style="font-size: 9pt; min-height: 20pt; text-indent: 0mm; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 20pt;">ext4文件系统上删除文件，可以恢复:</span> <span style="background-color: rgb(255, 250, 165); font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 20pt;-evernote-highlight:true;">extundelete</span> <span style="font-size: 9pt; min-height: 20pt; text-indent: 0mm; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 20pt;">，ext3恢复使用</span><span style="background-color: rgb(255, 250, 165); font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 20pt;-evernote-highlight:true;">：ext3grep</span></div><div style="margin: 0mm -13mm 0mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 20pt;"><span style="font-size: 9pt; min-height: 20pt; text-indent: 0mm; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 20pt;">windows恢复误删除的文件： </span> <span style="background-color: rgb(255, 250, 165); font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 20pt;-evernote-highlight:true;">final data v2.0 汉化版 </span> <span style="font-size: 9pt; min-height: 20pt; text-indent: 0mm; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 20pt;">和 </span> <span style="background-color: rgb(255, 250, 165); font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 20pt;-evernote-highlight:true;">easyrecovery </span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">扩展：</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; background-color: rgb(255, 250, 165);-evernote-highlight:true;">Linux文件系统由三部分组成：文件名，inode，block</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; background-color: rgb(255, 250, 165);-evernote-highlight:true;">windows也由这三部分组成。</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; background-color: rgb(255, 250, 165);-evernote-highlight:true;">a.txt          --&gt;inode              --&gt; block</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; background-color: rgb(255, 250, 165);-evernote-highlight:true;">文件名       存放文件元数据信息       真正存放数据</span></div></div></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">查看文件文件名：</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# cp /etc/passwd a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# ls a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">查看inode号：</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">常识： 每个文件，有一个inode号。</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# ls -i a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">440266 a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">查看inode中的文件属性;  通过stat命令查看inode中包含的内容</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# stat a.txt   #查看inode信息：</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# ls -l a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">-rw-r--r-- 1 root root 1720 Oct 25 10:21 a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">block块：真正存储数据的地方</span></div></div></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="font-size: 9pt; text-indent: 6mm;"><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 14pt;">逻辑删除：</span></span></div><div style="margin: 2.11mm 0mm; text-indent: 6mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="text-indent: 6mm; font-size: 9pt; color: rgb(255, 0, 0); font-family: 微软雅黑; font-weight: bold; line-height: 125%;">为什么删除比复制快？</span></div><div style="margin: 2.11mm 0mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="line-height: 125%;"><img src="4.0.8Centos6上恢复ext4文件系统下误删除的文件_files/Image.png" type="image/png" data-filename="Image.png" width="455"/></span></div><div style="margin: 2.11mm 0mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="line-height: 125%;"><img src="4.0.8Centos6上恢复ext4文件系统下误删除的文件_files/Image [1].png" type="image/png" data-filename="Image.png" width="414"/></span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">误删除文件后，第一件事要做什么？？？ </span><span style="font-size: 9pt; text-indent: 0mm; color: rgb(1, 1, 1); font-weight: bold; line-height: 14pt;">避免误删除的文件内容被覆盖。 如何避免？</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 20pt;"><span style="text-indent: 0mm; min-height: 20pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 20pt;">卸载需要恢复文件的分区或以只读的方式挂载</span></div><div style="margin: 2.11mm -13mm 2.11mm 0mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt;"><span style="font-size: 14pt; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 14pt;"> 实战：在ext4文件系统上恢复被误删除的文件</span></span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt;"><span style="font-size: 14pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">下载extundelete    </span></span><a href="http://sourceforge.net/" style="font-size: 9pt; text-indent: 0mm; font-family: ΢���ź�; font-weight: bold; line-height: 14pt;">http://sourceforge.net/</a><span style="font-size: 9pt; text-indent: 0mm; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 14pt;">    开源软件发布中心</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">准备测试分区：</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 /]# fdisk /dev/sda  #创建一个sda4分区</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">WARNING: DOS-compatible mode is deprecated. It's strongly recommended to</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">         switch off the mode (command 'c') and change display units to</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">         sectors (command 'u').</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Command (m for help): p   #查看现有分区表</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Disk /dev/sda: 21.5 GB, 21474836480 bytes</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">255 heads, 63 sectors/track, 2610 cylinders</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Units = cylinders of 16065 * 512 = 8225280 bytes</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Sector size (logical/physical): 512 bytes / 512 bytes</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">I/O size (minimum/optimal): 512 bytes / 512 bytes</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Disk identifier: 0x000b8b35</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">   Device Boot      Start         End      Blocks   Id  System</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">/dev/sda1   *           1          26      204800   83  Linux</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Partition 1 does not end on cylinder boundary.</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">/dev/sda2              26        1301    10240000   83  Linux</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">/dev/sda3            1301        1428     1024000   82  Linux swap / Solaris</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Command (m for help): n   #创建一个新分区</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Command action</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">   e   extended</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">   p   primary partition (1-4)</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">p  #创建一个主分区</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Selected partition 4</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">First cylinder (1428-2610, default 1428):</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Using default value 1428</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Last cylinder, +cylinders or +size{K,M,G} (1428-2610, default 2610): +1G  #指定分区大小</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Command (m for help): w  #保存</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">The partition table has been altered!</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Calling ioctl() to re-read partition table.</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">WARNING: Re-reading the partition table failed with error 16: Device or resource busy.</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">The kernel still uses the old table. The new table will be used at</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">the next reboot or after you run partprobe(8) or kpartx(8)</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">Syncing disks.</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]#reboot</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">或</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# partx -a /dev/sda  #获得新分区表</span></div></div></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-size: 14pt; color: rgb(1, 1, 1); font-weight: bold; line-height: 14pt;">扩展：</span></font></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt;"><span style="font-size: 14pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">如果在根下删除文件了，想恢复，怎么办？</span></span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(1, 1, 1);">方法1： 立即断电，然后把磁盘以只读方式，挂载到另一个电脑中进行恢复</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1);">方法2：把extundelete在虚拟机上（虚拟机系统要和服务器版本一样），提前安装好后再复制到U盘中，把U盘插入服务器，恢复时，恢复的文件要保存到U盘中，（不要让恢复的数据写到/下，那样会覆盖之前删除的文件）</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1);">使用新的分区表：</span></div><div><span style="font-size: 9pt;color: rgb(1, 1, 1);background-color: rgb(255, 250, 165);-evernote-highlight:true;">[root@xuegod63 /]# mkdir /tmp/sda4     #创建挂载点</span></div><div><span style="font-size: 9pt;color: rgb(1, 1, 1);background-color: rgb(255, 250, 165);-evernote-highlight:true;">[root@xuegod63 ~]# mkfs.ext4 /dev/sda4    #格式化</span></div><div><span style="font-size: 9pt;color: rgb(1, 1, 1);background-color: rgb(255, 250, 165);-evernote-highlight:true;">[root@xuegod63 ~]# mount /dev/sda4 /tmp/sda4/   #挂载</span></div></div></div><div style="margin: 2.11mm -13mm 2.11mm 0mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 14pt;">复制一些测试文件，然后把这些文件再删除，然后演示恢复：</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# cp /etc/passwd /tmp/sda4/</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# cp /etc/hosts /tmp/sda4/</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# echo aaa &gt; a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# mkdir -p /tmp/sda4/a/b/c</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# cp a.txt /tmp/sda4/a/</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# cp a.txt /tmp/sda4/a/b/</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# touch /tmp/sda4/a/b/kong.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">安装tree命令：</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# rpm -ivh /mnt/Packages/tree-1.5.3-2.el6.x86_64.rpm</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# tree /tmp/sda4/</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">/tmp/sda4/</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">├── a</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">│   ├── a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">│   └── b</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">│       ├── a.txt</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">│       ├── c  #空目录</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">│       └── kong.txt  #空文件</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">├── hosts</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">├── lost+found</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">└── passwd</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">删除文件：</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# cd /tmp/sda4/</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 sda4]# ls</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">a  hosts  lost+found  passwd</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 sda4]# rm -rf a hosts passwd</span></div></div></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">误删除文件后，第一件事要做什么？？？如何避免误删除的文件内容被覆盖？？？</span></div><div><span style="font-size: 9pt;">卸载需要恢复文件的分区：或以只读的方式挂载</span></div><div><span style="font-size: 9pt;">[root@localhost ~]#cd /root        #取消挂载，着要先退出挂载目录，再操作。</span></div><div>[root@localhost ~]# umount /tmp/sda4</div></div></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="font-size: 9pt;"><br/></span></div><div style="margin: 2.11mm -13mm 2.11mm 0mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt;"><span style="font-size: 14pt; color: rgb(167, 69, 0); font-family: ΢���ź�; font-weight: bold; line-height: 14pt;"> 安装extundelet </span></span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">解压并安装extundelet</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 extundelete-0.2.4]# tar jxvf extundelete-0.2.4.tar.bz2</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# cd extundelete-0.2.4</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63]# yum install e2fsprogs-devel</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 extundelete-0.2.4]# ./configure   #检查系统安装环境</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 extundelete-0.2.4]# make  -j 4  #编译，把源代码编译成可执行的二进制文件。</span></div></div></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 extundelete-0.2.4]# make install  #安装</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">install 和cp 有什么区别？</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">install 复制时可以指定权限  cp不可以</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">例：</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# install -m 777 /bin/find /opt/a.sh</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# ll /opt/</span></div></div></div><div style="margin: 2.11mm -13mm 2.11mm 0mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm;min-height: 14pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(167, 69, 0); font-weight: bold; line-height: 14pt;-evernote-highlight:true;">开始恢复：</span></span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">方法1：通过inode结点恢复</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">方法二：通过文件名恢复</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">方法三：恢复某个目录，如目录a下的所有文件：</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="text-indent: 0mm; min-height: 14pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 14pt;">方法四：恢复所有的文件</span></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# umount /tmp/sda4/</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# mkdir test  #创建一个目录使用于存放恢复的数据</span></div><div><span style="font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�;">[root@xuegod63 ~]# cd test/</span></div></div></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><br/></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>方法1：</div><div>通过inode结点查看被删除的文件名字：</div><div>[root@xuegod63 test]# extundelete /dev/sda4 --inode 2</div><div>.                                                2</div><div>lost+found                                        11</div><div>passwd                                            12             Deleted</div><div>hosts                                             13             Deleted</div><div>a                                                 7313           Deleted</div><div><br/></div><div>扩展：ext4文件系统的分区根目录的inode值为2，xfs分区根目录的inode值为64</div><div>[root@xuegod63 test]# ls -id /boot/   #xfs文件系统</div><div>64 /boot/</div></div></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div>[root@xuegod63 test]# mount /dev/sda4 /tmp/sda4/</div><div>[root@xuegod63 test]# ls -id /tmp/sda4/</div><div>2 /tmp/sda4/</div><div>[root@xuegod63 test]# umount /tmp/sda4/</div></div></div><div style="margin: 2.11mm -13mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 14pt;"><span style="font-size: 9pt;"><br/></span></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="text-indent: 0mm; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 125%;">方法1：</span><span style="text-indent: 0mm; font-size: 9pt; color: rgb(255, 0, 0); font-family: 微软雅黑; font-weight: bold; line-height: 125%;">通过inode结点恢复</span></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[root@xuegod63 test]# extundelete /dev/sda4 --restore-inode 12</div><div>NOTICE: Extended attributes are not restored.</div><div>Loading filesystem metadata ... 9 groups loaded.</div><div>Loading journal descriptors ... 63 descriptors loaded.</div><div>[root@xuegod63 test]# ls</div><div>RECOVERED_FILES</div><div>[root@xuegod63 test]# diff /etc/passwd RECOVERED_FILES/file.12  # 没有任何输出，说明一样</div></div></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="text-indent: 0mm; font-size: 9pt; color: rgb(255, 0, 0); font-family: 微软雅黑; font-weight: bold; line-height: 125%;">方法二，通过文件名恢复</span></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><br/></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[root@xuegod63 test]# extundelete /dev/sda4 --restore-file passwd</div><div>[root@xuegod63 test]# diff /etc/passwd RECOVERED_FILES/passwd  # 没有任何输出，说明一样</div></div></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="font-size: 9pt;"><br/></span></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="text-indent: 0mm; font-size: 9pt; font-family: 微软雅黑; font-weight: bold; line-height: 125%;">方法三：</span><span style="text-indent: 0mm; font-size: 9pt; color: rgb(255, 0, 0); font-family: 微软雅黑; font-weight: bold; line-height: 125%;">恢复某个目录</span><span style="text-indent: 0mm; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 125%;">，如目录a下的所有文件：</span></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><br/></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[root@xuegod63 test]# extundelete /dev/sda4 --restore-directory a</div><div>[root@xuegod63 test]# tree RECOVERED_FILES/a/</div><div>RECOVERED_FILES/a/</div><div>├── a.txt</div><div>└── b</div><div>└── a.txt</div><div>下面是原来的目录结构：</div><div>[root@xuegod63 ~]# tree /root/sda4-back/a/</div><div>/root/sda4-back/a/</div><div>├── a.txt</div><div>└── b</div><div>    ├── a.txt</div><div>    ├── c</div><div>└── kong.txt</div></div></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="font-size: 9pt;"><br/></span></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="text-indent: 0mm; font-size: 9pt; font-family: 微软雅黑; font-weight: bold; line-height: 125%;">方法四：</span><span style="text-indent: 0mm; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 125%;">恢复所有的文件</span></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="text-indent: 0mm; font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 125%;">[root@xuegod63 test]# extundelete /dev/sda4 --restore-</span><span style="text-indent: 0mm; font-size: 9pt; color: rgb(255, 0, 0); font-family: ΢���ź�; font-weight: bold; line-height: 125%;">all</span></div><div style="margin: 0mm -13mm 0mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 20pt;"><span style="text-indent: 0mm; min-height: 20pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 20pt;">删除前后的数据：</span></div><div style="margin: 2.11mm 0mm 2.11mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm;"><span style="line-height: 125%;"><img src="4.0.8Centos6上恢复ext4文件系统下误删除的文件_files/Image [2].png" type="image/png" data-filename="Image.png" width="424"/></span></div><div style="margin: 0mm -13mm 0mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 20pt;"><span style="text-indent: 0mm; min-height: 20pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: ΢���ź�; font-weight: bold; line-height: 20pt;">extundelete在恢复文件的时候能不能自动创建空文件和目录？</span></div><div style="margin: 0mm -13mm 0mm 7mm; text-indent: 0mm; padding-top: 0mm; padding-bottom: 0mm; min-height: 20pt;"><span style="text-indent: 0mm; min-height: 20pt; font-size: 9pt; color: rgb(1, 1, 1); font-family: 微软雅黑; font-weight: bold; line-height: 20pt;">答：不能。</span></div></span>
</div></body></html> 