<html>
<head>
  <title>4.0.5Swap分区扩展</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308859 (zh-CN, MWS); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1426"/>
<h1>4.0.5Swap分区扩展</h1>

<div>
<span><div><h1>Swap<span style="font-size: 9pt; font-family: 微软雅黑, sans-serif;-en-paragraph:true;">分区在系统的物理内存不够用的时候，把硬盘空间中的一部分空间释放出来，以供当前运行的程序使用。</span></h1><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">mkswap /devices</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">(</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">格式化成</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">swap</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">格式</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">swapon /swap (</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">激活</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/swap</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">，加入到</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">swap</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">分区中</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">vim /etc/fstab (</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">开机自启动新添加的</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">swap</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">分区</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">)</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">,</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">在最后追加：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/devices swap swap defaults 0 0</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">如果不想使用需要删除，只需要执行</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">#swapoff /swap</span></div><h2><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif;">12.3.1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif;"> </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif;">先分个区</span></h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# gdisk</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/dev/sdb</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">...</span></div><div><span style="font-size: 9pt;">Command (? for help): n  #新建分区</span></div><div><span style="font-size: 9pt;">Partition number (2-128, default 2):     #回车</span></div><div><span style="font-size: 9pt;">First sector (34-41943006, default = 2099200) or {+-}size{KMGTP}:  #回车</span></div><div><span style="font-size: 9pt;">Last sector (2099200-41943006, default = 41943006) or {+-}size{KMGTP}: +1G  #给1G</span></div><div><span style="font-size: 9pt;">Current type is 'Linux filesystem'</span></div><div><span style="font-size: 9pt;">Hex code or GUID (L to show codes, Enter = 8300):  #回车</span></div><div><span style="font-size: 9pt;">Changed type of partition to 'Linux filesystem'</span></div><div><span style="font-size: 9pt;">Command (? for help): w  #保存</span></div><div><span style="font-size: 9pt;">Do you want to proceed? (Y/N): y</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">格式化</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">swap</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">[root@xuegod63 ~]# mkswap /dev/sdb2</span></div><div><span style="font-size: 9pt;">正在设置交换空间版本 1，大小 = 2097148 KiB</span></div><div><span style="font-size: 9pt;">无标签，UUID=dc41b5ef-bcf1-477c-902e-c5bb00d41c1e</span></div><div><span style="font-size: 9pt;">验证：</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# <span style="background-color: rgb(255, 250, 165); font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;">free -m</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">    total        used        free      shared  buff/cache   available</span></div><div><span style="font-size: 9pt;">Mem:            977         557          75          16         345         168</span></div><div><span style="font-size: 9pt;">Swap:          2047         234        1813</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# <span style="background-color: rgb(255, 250, 165); font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;">swapon /dev/sdb2</span></span><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 9pt; background-color: rgb(255, 250, 165); font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;-en-paragraph:true;">  </span> <span style="font-size: 9pt; background-color: rgb(255, 250, 165); font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;-en-paragraph:true;">---</span><span style="font-size: 9pt; background-color: rgb(255, 250, 165); font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;-en-paragraph:true;">开启</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# free -m</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">       total        used        free      shared  buff/cache   available</span></div><div><span style="font-size: 9pt;">Mem:            977         556          75          16         345         169</span></div><div><span style="font-size: 9pt;"><b>Swap:          3071         234        2837</b></span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# <span style="background-color: rgb(255, 250, 165); font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;">swapoff /dev/sdb2</span></span><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 9pt; background-color: rgb(255, 250, 165); font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;-en-paragraph:true;">   </span> <span style="font-size: 9pt; background-color: rgb(255, 250, 165); font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;-en-paragraph:true;">---</span><span style="font-size: 9pt; background-color: rgb(255, 250, 165); font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;-en-paragraph:true;">关闭</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# free -m</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">total        used        free      shared  buff/cache   available</span></div><div><span style="font-size: 9pt;">Mem:            977         556          75          16         345         169</span></div><div><span style="font-size: 9pt;"><b>Swap:          2047         234        1813</b></span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# <span style="background-color: rgb(255, 250, 165); font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-evernote-highlight:true;">swapon -s</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">Filename                      Type              Size Used       Priority</span></div><div><span style="font-size: 9pt;">/dev/dm-1                                 partition 2097148  240532    -1</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# swapon /dev/sdb2</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# swapon -s</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">#</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">查看</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">Filename                      Type              Size Used       Priority</span></div><div><span style="font-size: 9pt;">/dev/dm-1                                 partition 2097148  240532    -1</span></div><div><span style="font-size: 9pt;">/dev/sdb2                                 partition 1048572  0     -2</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">2</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">通过文件增加</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">SWAP</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">空间</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">[root@xuegod63 ~]# dd if=/dev/zero of=swap_file bs=1M count=500</span></div><div><span style="font-size: 9pt;">[root@xuegod63 ~]# ll /root/swap_file</span></div><div><span style="font-size: 9pt;">[root@xuegod63 ~]# chmod 0600 /root/swap_file</span></div><div><span style="font-size: 9pt;">[root@xuegod63 ~]# mkswap -f /root/swap_file</span></div><div><span style="font-size: 9pt;">[root@xuegod63 ~]# swapon /root/swap_file</span></div><div><span style="font-size: 9pt;">[root@xuegod63 ~]# free -m</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 