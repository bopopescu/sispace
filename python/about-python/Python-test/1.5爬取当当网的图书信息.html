<html>
<head>
  <title>1.5爬取当当网的图书信息</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308919 (zh-CN, MWS); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="721"/>
<h1>1.5爬取当当网的图书信息</h1>

<div>
<span><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import requests</div><div>from lxml import html</div><div><br/></div><div><b><font style="font-size: 12pt;">#本程序的book_list相关的东西都可以忽略</font></b></div><div><br/></div><div>def spider(sn, book_list=[]):</div><div>    &quot;&quot;&quot; 爬取当当网的数据 &quot;&quot;&quot;</div><div>    url = 'http://search.dangdang.com/?key={sn}&amp;act=input'.format(sn=sn)</div><div>    # 获取html内容</div><div>    html_data = requests.get(url).text</div><div><br/></div><div>    # xpath对象</div><div>    selector = html.fromstring(html_data)</div><div><br/></div><div>    # 找到书本列表</div><div>    ul_list = selector.xpath('//div[@id=&quot;search_nature_rg&quot;]/ul/li')</div><div>    print(len(ul_list))</div><div>    for li in ul_list:</div><div>        # 标题</div><div>        title = li.xpath('a/@title')</div><div>        print(title[0])</div><div>        # 购买链接</div><div>        link = li.xpath('a/@href')</div><div>        print(link[0])</div><div>        # 价格</div><div>        price = li.xpath('p[@class=&quot;price&quot;]/span[@class=&quot;search_now_price&quot;]/text()')</div><div>        print(price[0].replace('¥', ''))</div><div><br/></div><div>        # 商家</div><div>        store = li.xpath('p[@class=&quot;search_shangjia&quot;]/a/text()')</div><div>        store = '当当自营' if len(store) == 0 else store[0]</div><div>        print(store)</div><div>        print('-----------------------')</div><div>        </div><div><br/></div><div>        #由于图书在一个页面不仅仅是一本的，是个可变的列表。因此常用追加的方式</div><div>        book_list.append({</div><div>            'title': title[0],</div><div>            'price': price[0].replace('¥', ''),</div><div>            'link': link[0],</div><div>            'store': store[0]</div><div>        })</div><div><br/></div><div><br/></div><div>if __name__ == '__main__':</div><div>    </div><div>    sn = '9787115428028'</div><div>    spider(sn)</div></div><div><br/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">爬取京东网页的图书信息：【这个与上面没有太大的差别，</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">        只是添加了一个编码</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">        和xpth的属性很深而已】</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import requests</div><div>from lxml import html</div><div><br/></div><div><font style="font-size: 12pt;"><b><br/></b></font></div><div><font style="font-size: 12pt;"><b>#本程序的book_list相关的东西都可以忽略</b></font></div><div><br/></div><div>def spider(sn, book_list=[]):</div><div>    &quot;&quot;&quot; 爬取京东的图书数据 &quot;&quot;&quot;</div><div>    url = 'https://search.jd.com/Search?keyword={0}'.format(sn)</div><div>    # 获取HTML文档</div><div><br/></div><div>    resp = requests.get(url)</div><div>    print(resp.encoding)</div><div>    resp.encoding = 'utf-8'</div><div><br/></div><div>    html_doc = resp.text</div><div><br/></div><div>    # 获取xpath对象</div><div>    selector = html.fromstring(html_doc)</div><div><br/></div><div>    # 找到列表的集合</div><div>    ul_list = selector.xpath('//div[@id=&quot;J_goodsList&quot;]/ul/li')</div><div>    print(len(ul_list))</div><div><br/></div><div>    # 解析对应的内容，标题，价格，链接</div><div>    for li in ul_list:</div><div>        # 标题</div><div>        title = li.xpath('div/div[@class=&quot;p-name&quot;]/a/@title')</div><div>        print(title[0])</div><div>        # 购买链接</div><div>        link = li.xpath('div/div[@class=&quot;p-name&quot;]/a/@href')</div><div>        print(link[0])</div><div><br/></div><div>        # 价格</div><div>        price = li.xpath('div/div[@class=&quot;p-price&quot;]/strong/i/text()')</div><div>        print(price[0])</div><div><br/></div><div>        # 店铺</div><div>        store = li.xpath('div//a[@class=&quot;curr-shop&quot;]/@title')</div><div>        print(store[0])</div><div><br/></div><div>        book_list.append({</div><div>            'title': title[0],</div><div>            'price': price[0],</div><div>            'link': link[0],</div><div>            'store': store[0]</div><div>        })</div><div><br/></div><div><br/></div><div>if __name__ == '__main__':</div><div>    spider('9787115428028')</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>一号店的信息爬取：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import requests</div><div>from lxml import html</div><div><br/></div><div><br/></div><div><b><font style="font-size: 12pt;">#本程序的book_list相关的东西都可以忽略</font></b></div><div><br/></div><div>def spider(sn, book_list=[]):</div><div>    &quot;&quot;&quot; 爬取1号店的图书数据 &quot;&quot;&quot;</div><div>    url = 'https://search.yhd.com/c0-0/k{0}/'.format(sn)</div><div>    # 获取到html源码</div><div>    html_doc = requests.get(url).text</div><div><br/></div><div>    # xpath对象</div><div>    selector = html.fromstring(html_doc)</div><div><br/></div><div>    # 书籍列表</div><div>    ul_list = selector.xpath('//div[@id=&quot;itemSearchList&quot;]/div')</div><div>    print(len(ul_list))</div><div><br/></div><div>    # 解析数据</div><div>    for li in ul_list:</div><div>        <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"># 标题，不关注div下面还有多少个div，</span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">        #使用的后面固定前面元素的方法。相当一种相对路径的查找方法</span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">        title = li.xpath('div/p[@class=&quot;proName clearfix&quot;]/a/@title')</span></div><div>        print(title[0])</div><div>        # 价格</div><div>        price = li.xpath('div//p[@class=&quot;proPrice&quot;]/em/@yhdprice')</div><div>        print(price[0])</div><div>        # 购买链接</div><div>        link = li.xpath('div/p[@class=&quot;proName clearfix&quot;]/a/@href')</div><div>        print(link[0])</div><div>        # 店铺</div><div>        store = li.xpath('div/p[@class=&quot;storeName limit_width&quot;]/a/@title')</div><div>        print(store)</div><div><br/></div><div>        book_list.append({</div><div>            'title': title[0],</div><div>            'price': price[0],</div><div>            'link': link[0],</div><div>            'store': store[0]</div><div>        })</div><div><br/></div><div><br/></div><div><br/></div><div>if __name__ == '__main__':</div><div>    spider('9787115428028')</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 