<html>
<head>
  <title>4.0.8xfs.文件备份</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308859 (zh-CN, MWS); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1233"/>
<h1>4.0.8xfs.文件备份</h1>

<div>
<span><div>使用此链接实现分区。<a href="4.0.4挂载硬盘u盘.html" style="color: rgb(105, 170, 53);">挂载硬盘/u盘</a></div><div>格式化时请使用<span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">使用新的分区，格式化分区，并进行挂载</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]#</span> <span style="font-size: 9pt; background: yellow; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">mkfs.xfs</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/dev/sdb1</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# mkdir /sdb1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">    </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">#</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">创建挂载点</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# mount /dev/sdb1 /sdb1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">  </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">#</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">挂载，【源】【目的】</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">准备备份测试文件</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# cd /sdb1/</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 sdb1]# cp /etc/passwd ./#【复制一份资料到目的地】</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 sdb1]# mkdir test</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 sdb1]# touch test/a</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 sdb1]# tree /sdb1/【要求已安装了tree，可使用yum install tree 】</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/sdb1/</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">├──</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">passwd</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">└──</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">test</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">   </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">└──</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">a</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">4.4.2</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">备份</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">、备份整个分区。 （这个功能就像是虚拟机的快照，服务器被黑后，进行快速恢复）</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"><span>    </span><span>    </span>【</span><b style="font-size: 9pt;">使用 xfsdump 时，请注意下面下面的几个限制：</b></div><div><span style="font-size: 9pt;"><b><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span>1、xfsdump 不支持没有挂载的文件系统备份！所以只能备份已挂载的！</b></span></div><div><span style="font-size: 9pt;"><b><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span>2、xfsdump 必须使用 root 的权限才能操作 (涉及文件系统的关系)</b></span></div><div><span style="font-size: 9pt;"><b><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span>3、xfsdump 只能备份 XFS 文件系统</b></span></div><div><span style="font-size: 9pt;"><b><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span>4、xfsdump 备份下来的数据 (档案或储存媒体) 只能让 xfsrestore 解析</b></span></div><div><b style="font-size: 9pt;"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span>5、xfsdump 是透过文件系统的 UUID 来分辨各个备份档的，因此不能备份两个具有相同 UUID 的文件系统</b></div><div><span style="font-family: 微软雅黑, sans-serif; font-size: 9pt; font-weight: bold;"><span>    </span><span>    </span><span>    </span>】</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">xfsdump</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">-f</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">备份存放位置</span> <span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">要备份路径或设备文件</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">注意：备份的路径这里不能写成</span><span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/sdb1/</span><span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">。</span><span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span> <span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">可以是</span><span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/dev/sdb1</span> <span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">或</span><span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/sdb1</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 sdb1]# xfsdump -f /opt/dump_sdb1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/dev/sdb1【要求安装了xfsdump,yum install xfsdump】</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">xfsdump: using file dump (drive_simple) strategy</span></div><div><span style="font-size: 9pt;">xfsdump: version 3.1.4 (dump format 3.0) - type ^C for status and control</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">========== dump label dialog ==============================</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">please enter label for this dump session (timeout in 300 sec)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">-&gt;</span> <span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">dump_sdb1</span><span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span> <span style="color: red; font-family: 微软雅黑, sans-serif;-en-paragraph:true;">指定备份会话标签</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">session label entered: &quot;dump_sdb1&quot;</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">--------------------------------- end dialog ---------------------------------</span></div><div><span style="font-size: 9pt;">xfsdump: level 0 dump of xuegod63.cn:/sdb1</span></div><div><span style="font-size: 9pt;">xfsdump: dump date: Fri Nov 17 12:24:53 2017</span></div><div><span style="font-size: 9pt;">xfsdump: session id: b5a25fcd-d43d-4308-bf29-142066f89d9a</span></div><div><span style="font-size: 9pt;">xfsdump: session label: &quot;dump_sdb1&quot;</span></div><div><span style="font-size: 9pt;">xfsdump: ino map phase 1: constructing initial dump list</span></div><div><span style="font-size: 9pt;">xfsdump: ino map phase 2: skipping (no pruning necessary)</span></div><div><span style="font-size: 9pt;">xfsdump: ino map phase 3: skipping (only one dump stream)</span></div><div><span style="font-size: 9pt;">xfsdump: ino map construction complete</span></div><div><span style="font-size: 9pt;">xfsdump: estimated dump size: 25856 bytes</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">============== media label dialog =============================</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">please enter label for media in drive 0 (timeout in 300 sec)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">-&gt; sdb1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span> <span style="color: red; font-family: 微软雅黑, sans-serif;-en-paragraph:true;">指定设备标签，就是对要备份的设备做一个描述</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">media label entered: &quot;sdb1&quot;</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">--------------------------------- end dialog --------------------------------</span></div><div><span style="font-size: 9pt;">xfsdump: creating dump session media file 0 (media 0, file 0)</span></div><div><span style="font-size: 9pt;">xfsdump: dumping ino map</span></div><div><span style="font-size: 9pt;">xfsdump: dumping directories</span></div><div><span style="font-size: 9pt;">xfsdump: dumping non-directory files</span></div><div><span style="font-size: 9pt;">xfsdump: ending media file</span></div><div><span style="font-size: 9pt;">xfsdump: media file size 24544 bytes</span></div><div><span style="font-size: 9pt;">xfsdump: dump size (non-dir files) : 2592 bytes</span></div><div><span style="font-size: 9pt;">xfsdump: dump complete: 46 seconds elapsed</span></div><div><span style="font-size: 9pt;">xfsdump: Dump Summary:</span></div><div><span style="font-size: 9pt;">xfsdump:   stream 0 /opt/dump_sdb1 OK (success)</span></div><div><span style="font-size: 9pt;">xfsdump: Dump Status: SUCCESS</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">2</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">、 指定备份时免交互操作，方便后期做定时备份</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">[root@xuegod63 sdb1]# xfsdump -f /opt/dump_passwd /sdb1 -L dump_passwd -M media1</span></div><div>-L  ：xfsdump  纪录每次备份的 session 标头，这里可以填写针对此文件系统的简易说明</div><div>-M  ：xfsdump 可以纪录储存媒体的标头，这里可以填写此媒体的简易说明</div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">3、指定只备份分区中某个目录</span></div><div><span style="font-size: 9pt;">参数：-s 文件路径  只对指定的文件进行备份，-s指定时，路径写的是相对路径(-s可以是文件或目录)</span></div><div><span style="font-size: 9pt;">[root@xuegod63 sdb1]# xfsdump -f /opt/dump_grub2 -s grub2/grub.cfg /boot -L dump_grub2 -M boot-sda1</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">4、查看备份信息与内容</span></div><div><span style="font-size: 9pt;">备份成功后，我们就可以在/var/lib/xfsdump/inventory目录下看到生成的档案信息</span></div><div><span style="font-size: 9pt;">[root@xuegod63 opt]# xfsdump  -I（字母大写i）</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">测试恢复：先删除之前创建的内容</span></div><div><span style="font-size: 9pt;">[root@xuegod63 sdb1]# ls</span></div><div><span style="font-size: 9pt;">passwd  test</span></div><div><span style="font-size: 9pt;">[root@xuegod63 sdb1]# pwd</span></div><div><span style="font-size: 9pt;">/sdb1</span></div><div><span style="font-size: 9pt;">[root@xuegod63 sdb1]# rm -rf ./*</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>4.4.3 文件系统恢复</div><div>语法：xfsrestore -f 指定恢复文件的位置 指定存放恢复后的文件的路径</div><div>[root@xuegod63 opt]# xfsrestore -f /opt/dump_sdb1  /sdb1</div><div>查看恢复情况</div><div>[root@xuegod63 ~]# ls /sdb1/</div><div>恢复单个文件如下：</div><div>[root@xuegod63 ~]# mkdir /var/test/</div><div>[root@xuegod63 ~]# xfsrestore -f /opt/dump_grub2 -s grub2/grub.cfg /var/test/</div><div>[root@xuegod63 ~]# xfsrestore -f /opt/dump_grub2 -s grub2 /var/test/  #恢复目录</div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span></div></span>
</div></body></html> 