<html>
<head>
  <title>2.0.6RPM理论知识</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308859 (zh-CN, MWS); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1432"/>
<h1>2.0.6RPM理论知识</h1>

<div>
<span><div><span style="font-size: 11pt;">/*</span></div><div><span style="font-size: 11pt;">author:junwei_zhou</span></div><div><span style="font-size: 11pt;">    date:3/9/12</span></div><div><span style="font-size: 11pt;">    link：</span></div><div><span style="font-size: 11pt;">*/</span></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;">软件包管理:</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>软件包管理工具:RPM</div><div>应用程序:和CPU架构密不可分的</div><div>源代码--编译--链接--运行</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>链接:</div><div>  库:静态库和动态库  .so  shared object</div><div>     静态链接过程:把库文件集成到应用程序中</div><div>     动态链接过程:库文件和应用程序分开的,做链接</div></div><div><font style="font-size: 11pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>编译:生成二进制文件(可执行文件),匹配底层架构</div><div>程序=数据+指令  应用程序运行时,申请CPU和内存资源</div></div><div><font style="font-size: 11pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>内存地址空间:</div><div>text:存放指令</div><div>data+BSS:data存放数据,BSS:block system of symbol:存放初始化为0的变量</div><div>堆:heap存放运行中临时文件</div><div>栈:stack存放应用程序的变量和函数等</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>应用程序中:</div><div>    二进制文件(可执行程序)/bin /sbin /etc/ /usr/bin  /usr/sbin</div><div>    库</div><div>    配置文件</div><div>    帮助文件/usr/share</div><div>    /usr/local:独立</div></div><div><font style="font-size: 11pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>软件包管理器的核心功能：</div><div>        1、制作软件包；</div><div>        2、安装、卸载、升级、查询、校验；</div></div><div><br/></div><div><span style="font-size: 11pt;">    </span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>前端工具：yum, apt-get,自行解决依赖关系</div><div>后端工具：RPM, dpt[初学者，优选]</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>RPM优点:</div><div>                1:RPM软件包中包含了编译过的程序与配置文件,用户不用重新编译</div><div>                2:RPM在安装之前,首先会检查硬盘容量,操作系统版本等,避免被错误安装</div><div>                3:RPM使用RPM数据库管理,数据中记录应用程序的参数,便于升级,卸载,查询等,RPM数据库(/var/lib/rpm)</div><div>                4:RPM本身会提供应用程序版本信息,相关属性,软件名称,用途等,便于用户了解软件</div></div><div><font style="font-size: 11pt;"><br/></font></div><div><span style="font-size: 11pt;">RPM功能:安装、查询、卸载、升级、校验、数据库的重建、验正数据包等工作；</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>rpm命名：</div><div>包：组成部分</div><div>    主包：</div><div>        bind-9.7.1-1.el5.i586.rpm</div><div>    子包：</div><div>        bind-libs-9.7.1-1.el5.i586.rpm</div><div>        bind-utils-9.7.1-1.el5.i586.rpm</div><div>包名格式：</div><div>    name-version-release.arch.rpm</div><div>    bind-major.minor.release-release.arch.rpm</div></div><div><font style="font-size: 11pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>主版本号:功能重大改进修改主版本号</div><div>次版本号:某个子功能发生重大变化</div><div>发行号:修正了部分bug,调整了一点功能</div></div><div><font style="font-size: 11pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>RPM包:经过源代码编译后的软件包</div><div>.tar.gz:源码包,没有经过编译</div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">1:安装:rpm -ivh name.rpm</span></div><div>    -i:安装软件包</div><div>    -h:以#显示进度；每个#表示2%;</div><div>    -v:显示详细过程</div><div>rpm -ivh /PATH/TO/PACKAGE_FILE</div><div>    --nodeps:忽略依赖关系,可能导致软件包安装不完整</div><div>    --replacepkgs:重新安装,替换原有安装；</div><div>    --force:强行安装,可以实现重装或降级；</div></div><div><span style="font-size: 11pt;">    </span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">2、查询</span></div><div>    rpm -q PACKAGE_NAME： 查询指定的包是否已经安装</div><div>    rpm -qa : 查询已经安装的所有包</div><div><br/></div><div>    rpm -qi PACKAGE_NAME: 查询指定包的说明信息；</div><div>    rpm -ql PACKAGE_NAME: 查询指定包安装后生成的文件列表；</div><div>    rpm -qc PACEAGE_NEME：查询指定包安装的配置文件；</div><div>    rpm -qd PACKAGE_NAME: 查询指定包安装的帮助文件；</div><div>    rpm -qf /path/to/somefile: 查询指定的文件是由哪个rpm包安装生成的；</div><div>    rpm -q --scripts PACKAGE_NAME: 查询指定包中包含的脚本</div><div>      脚本:包含软件包安装前(preinstall),安装后(postinstall),卸载前(preuninstall),卸载后(postuninstall)执行的脚本</div><div>    </div><div>    如果某rpm包尚未安装，我们需查询其说明信息、安装以后会生成的文件；</div><div>    rpm -qpi /PATH/TO/PACKAGE_FILE:查看未安装软件包信息</div><div>    rpm -qpl :查看未安装软件包列表</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">3、升级</span></div><div>    rpm -Uvh /PATH/TO/NEW_PACKAGE_FILE: 如果装有老版本的，则升级；否则，则安装；</div><div>    rpm -Fvh /PATH/TO/NEW_PACKAGE_FILE：如果装有老版本的，则升级；否则，退出；</div><div>        --oldpackage: 降级</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">4、卸载</span></div><div>        rpm -e PACKAGE_NAME</div><div>        --nodeps:卸载时忽略依赖关系</div></div><div><span style="font-size: 11pt;">    </span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>5、校验:验证软件包列表或配置文件的完整性</div><div>        rpm -V PACKAGE_NAME</div><div>        应用程序配置文件完整性破坏以后的代码:</div><div>        S file Size differs</div><div>        M Mode differs (includes permissions and file type)</div><div>        5 digest (formerly MD5 sum) differs</div><div>        D Device major/minor number mismatch</div><div>        L readLink(2) path mismatch</div><div>        U User ownership differs</div><div>        G Group ownership differs</div><div>        T mTime differs</div><div>        P caPabilities differ</div></div><div><span style="font-size: 11pt;">    </span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>6、重建数据库</div><div>        rpm</div><div>            --rebuilddb: 重建数据库，一定会重新建立；</div><div>            --initdb:初始化数据库，没有才建立，有就不用建立；</div></div><div><font style="font-size: 11pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>7、检验来源合法性，及软件包完整性；</div><div>    # ls /etc/pki/rpm-gpg/</div><div>        RPM-GPG-KEY-redhat-release</div><div>    rpm -K /PAPT/TO/PACKAGE_FILE</div><div>        dsa, gpg: 验正来源合法性，也即验正签名；可以使用--nosignature，略过此项</div><div>        sha1, md5: 验正软件包完整性；可以使用--nodigest，略过此项</div><div>          rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release: 导入密钥文件【不一定适用centos6】</div></div><div><br/></div></span>
</div></body></html> 