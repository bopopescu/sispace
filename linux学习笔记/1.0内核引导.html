<html>
<head>
  <title>1.0内核引导</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308859 (zh-CN, MWS); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1238"/>
<h1>1.0内核引导</h1>

<div>
<span><div>内核引导</div><div>/*</div><div>author:junwei_zhou</div><div>date:4/19/2019</div><div>*/</div><div>当计算机打开电源后，首先是BIOS开机自检，按照BIOS中设置的启动设备（通常是硬盘）来启动。</div><div><br/></div><div>操作系统接管硬件以后，首先读入 /boot 目录下的内核文件。</div><div>运行init【操作系统-&gt;/boot-&gt;init进程】</div><div>init 进程是系统所有进程的起点，你可以把它比拟成系统所有进程的老祖宗，没有这个进程，系统中任何进程都不会启动。</div><div>init 程序首先是需要读取配置文件 /etc/inittab。</div><div><br/></div><div>运行级别【操作系统-&gt;/boot-&gt;init进程-&gt;运行级别】</div><div>许多程序需要开机启动。它们在Windows叫做&quot;服务&quot;（service），在Linux就叫做&quot;守护进程&quot;（daemon）。</div><div>init进程的一大任务，就是去运行这些开机启动的程序。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Linux系统有7个运行级别(runlevel)：</div><div>    运行级别0：系统停机状态，系统默认运行级别不能设为0，否则不能正常启动</div><div>    运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登陆</div><div>    运行级别2：多用户状态(没有NFS)</div><div>    运行级别3：完全的多用户状态(有NFS)，登陆后进入控制台命令行模式</div><div>    运行级别4：系统未使用，保留</div><div>    运行级别5：X11控制台，登陆后进入图形GUI模式</div><div>    运行级别6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动</div></div><div>系统初始化</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>在init的配置文件中有这么一行： si::sysinit:/etc/rc.d/rc.sysinit　它调用执行了/etc/rc.d/rc.sysinit，</div><div>而rc.sysinit是一个bash shell的脚本，它主要是完成一些系统初始化的工作，rc.sysinit是每一个运行级别都要首先运行的重要脚本。</div><div>它主要完成的工作有：激活交换分区，检查磁盘，加载硬件模块以及其它一些需要优先执行任务。</div><div>l5:5:wait:/etc/rc.d/rc 5</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>这一行表示以5为参数运行/etc/rc.d/rc，/etc/rc.d/rc是一个Shell脚本，它接受5作为参数，去执行/etc/rc.d/rc5.d/目录下的所有的rc启动脚本，/etc/rc.d/rc5.d/目录中的这些启动脚本实际上都是一些连接文件，而不是真正的rc启动脚本，真正的rc启动脚本实际上都是放在/etc/rc.d/init.d/目录下。</div></div><div><br/></div><div>而这些rc启动脚本有着类似的用法，它们一般能接受start、stop、restart、status等参数。</div><div><br/></div><div>/etc/rc.d/rc5.d/中的rc启动脚本通常是K或S开头的连接文件，对于以 S 开头的启动脚本，将以start参数来运行。</div><div><br/></div><div>而如果发现存在相应的脚本也存在K打头的连接，而且已经处于运行态了(以/var/lock/subsys/下的文件作为标志)，则将首先以stop为参数停止这些已经启动了的守护进程，然后再重新运行。</div><div><br/></div><div>这样做是为了保证是当init改变运行级别时，所有相关的守护进程都将重启。</div><div><br/></div><div>建立终端</div><div><br/></div><div>rc执行完毕后，返回init。这时基本系统环境已经设置好了，各种守护进程也已经启动了。</div><div><br/></div><div>init接下来会打开6个终端，以便用户登录系统。在inittab中的以下6行就是定义了6个终端：</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1:2345:respawn:/sbin/mingetty tty1</div><div>2:2345:respawn:/sbin/mingetty tty2</div><div>3:2345:respawn:/sbin/mingetty tty3</div><div>4:2345:respawn:/sbin/mingetty tty4</div><div>5:2345:respawn:/sbin/mingetty tty5</div><div>6:2345:respawn:/sbin/mingetty tty6</div><div><br/></div><div>当我们看到mingetty的登录界面时，我们就可以输入用户名和密码来登录系统了。</div><div>Linux 的账号验证程序是 login，login 会接收 mingetty 传来的用户名作为用户名参数</div></div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>然后 login 会对用户名进行分析：如果用户名不是 root，且存在 /etc/nologin 文件，login 将输出 nologin 文件的内容，然后退出。</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>这通常用来系统维护时防止非root用户登录。只有/etc/securetty中登记了的终端才允许 root 用户登录，</div><div>如果不存在这个文件，则 root 用户可以在任何终端上登录。</div><div>/etc/usertty文件用于对用户作出附加访问限制，如果不存在这个文件，则没有其他限制。</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Linux 关机</div><div>正确的关机流程为：sync &gt; shutdown &gt; reboot &gt; halt</div><div>sync 将数据由内存同步到硬盘中。</div></div><div><br/></div><div>关机的命令有 shutdown –h now halt poweroff 和 init 0 , 重启系统的命令有 shutdown –r now reboot init 6。</div><div>halt 命令通知硬件来停止所有的 CPU 功能，但是仍然保持通电。你可以用它使系统处于低层维护状态。注意在有些情况会它会完全关闭系统。</div><div># halt -p          ### 关闭机器</div><div><br/></div><div>[Ctrl]+ C 如果在Linux 底下输入了错误的指令或参数，想让当前的程序『停掉』的话，可以输入：</div><div><br/></div><div>[Ctrl]-d 『键盘输入结束(End Of File, EOF 或 End Of Input)』的意思</div><div><br/></div><div>另外，他也可以用来取代 exit 的输入。</div><div><a href="1.0人性化的一些设置.html" style="font-size: 14pt; color: rgb(105, 170, 53);">人性化的一些设置</a></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 