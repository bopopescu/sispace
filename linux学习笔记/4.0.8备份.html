<html>
<head>
  <title>4.0.8备份</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308859 (zh-CN, MWS); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1232"/>
<h1>4.0.8备份</h1>

<div>
<span><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>首先了解一下xfsdump的备份级别有以下两种，默认为0（即完全备份）</div><div>0 级别代表：           完全备份</div><div>1  到9级别代表：      增量备份</div></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt;">完全备份：每次都把指定的备份目录完整的复制一遍，不管目录下的文件有没有变化；</span></div><div><span style="font-size: 9pt;">增量备份：每次将之前（第一次、第二次、直到前一次）做过备份之后有变化的文件进行备份；</span></div><div><span style="font-size: 9pt;">差异备份：每次都将第一次完整备份以来有变化的文件进行备份。</span></div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">增量备份</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>概念</div><div>       增量备份是指在一次全备份或上一次增量备份后，以后每次的备份只需备份与前一次相比增加或者被修改的文件。这就意味着，第一次增量备份的对象是进行全备后所产生的增加和修改的文件；第二次增量备份的对象是进行第一次增量备份后所产生的增加和修改的文件，以此类推。</div><div>优缺点</div><div>优点：没有重复的备份数据，因此备份的数据量不大，备份所需的时间很短。</div><div>缺点：数据恢复相对比较麻烦，它需要上一次全备份和所有增量备份的内容才能够完全恢复成功，并且它们必须沿着从全备份到依次增量备份的时间顺序逐个反推恢复，因此可能会延长的恢复时间</div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">准备一个备份目录进行备份</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 sdb1]# tree</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/sdb1</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">/sdb1/</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">├──</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">passwd</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">└──</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">test</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">   </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">└──</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">a</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">对上面的内容进行第一次全备</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 sdb1]# xfsdump -f /opt/test-full /sdb1 -L test-full -M media0</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>增加一些内容，然后进行第1次增量备份</div><div>[root@xuegod63 ~]# touch  /sdb1/1.txt /sdb1/2.txt</div><div>[root@xuegod63 ~]# tree  /sdb1/</div><div>/sdb1/</div><div>├── 1.txt</div><div>├── 2.txt</div><div>├── passwd</div><div>└── test</div><div>└── a</div><div>[root@xuegod63 sdb1]# xfsdump <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">-l 1</span> -f /opt/test-back1 /sdb1 -L test-bak1 -M media0</div><div>-l &lt;level&gt;  做一个等级为1的备份</div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>再次增加内容，然后进行level 2级别的增量备</div><div>[root@xuegod63 sdb1]# touch  /sdb1/test/a.txt  /sdb1/test/b.txt</div><div>[root@xuegod63 ~]# tree /sdb1/</div><div>/sdb1/</div><div>├── 1.txt</div><div>├── 2.txt</div><div>├── passwd</div><div>└── test</div><div>    ├── a</div><div>    ├── a.txt</div><div>└── b.txt</div><div>[root@xuegod63 sdb1]# xfsdump -l 2 -f /opt/test-back2 /sdb1 -L test-bak2 -M media0【-l,字母】</div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;"> </span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">[root@xuegod63 ~]# rm -rf /sdb1/*</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">   </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">#</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">删除所有数据</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; color: red; font-family: 微软雅黑, sans-serif; font-weight: bold;">现在进行恢复，要想恢复全部全部数据，包括新添加的文件，如何恢复？</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">步骤：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">      </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">、先恢复完全备份</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">   </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">      </span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">2</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">、情况</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">1:</span> <span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">恢复最后一次增量备份（如果两次增量备份都是</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">级的，所以只需要恢复最后一个增量就可以了。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">       3</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">、情况</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">2</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">：如果你做的是第一次是</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">级备，第二次是</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">2</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">级备，那么你在恢复的时候就需要先恢复完全备份，然后是</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">1</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">级备，最后是</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">2</span><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">级备）</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[root@xuegod63 ~]# xfsrestore -f /opt/test-full /sdb1/</div><div>[root@xuegod63 ~]# xfsrestore -f /opt/test-back2 /sdb1/  #故意先恢复back2，查看</div><div>[root@xuegod63 ~]# tree /sdb1/  #查看，发现没有1.txt ,2.txt</div><div>/sdb1/</div><div>├── passwd</div><div>└── test</div><div>    ├── a</div><div>    ├── a.txt</div><div>└── b.txt</div><div>[root@xuegod63 ~]# xfsrestore -f /opt/test-back1 /sdb1/  </div><div>[root@xuegod63 ~]# tree /sdb1/</div></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 9pt; font-family: 微软雅黑, sans-serif; font-weight: bold;-en-paragraph:true;">到此，数据恢复成功了。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/><br/></div></span>
</div></body></html> 