<html>
<head>
  <title>1.7制作图书比价工具</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308919 (zh-CN, MWS); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="719"/>
<h1>1.7制作图书比价工具</h1>

<div>
<span><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from chapter01.spider_dangdang import spider as dangdang</div><div>from chapter01.spider_jd import spider as jd</div><div>from chapter01.spider_yhd import spider as yhd</div><div>from chapter01.spider_taobao import  spider as taobao</div><div><br/></div><div>def main(sn):</div><div>    &quot;&quot;&quot; 图书比价工具整合 &quot;&quot;&quot;</div><div>    book_list = []</div><div>    # 当当网的数据</div><div>    print('当当网数据爬取完成')</div><div>    dangdang(sn, book_list)</div><div><br/></div><div>    # 京东网数据</div><div>    print('京东网数据爬取完成')</div><div>    jd(sn, book_list)</div><div><br/></div><div>    # 1号店数据</div><div>    print('1号店数据爬取完成')</div><div>    yhd(sn, book_list)</div><div><br/></div><div>    # 淘宝数据</div><div>    print('淘宝网数据爬取完成')</div><div>    taobao(sn, book_list)</div><div><br/></div><div>    # 打印所有数据列表</div><div>    for book in book_list:</div><div>        print(book)</div><div><br/></div><div>    print('----------------开始排序-----------')</div><div><br/></div><div>    # 排序书的数据</div><div>    book_list = sorted(book_list, key=lambda item: float(item[&quot;price&quot;]), reverse=True)</div><div>    for book in book_list:</div><div>        print(book)</div><div><br/></div><div>if __name__ == '__main__':</div><div>    sn = input('请输入ISBN:')</div><div>    main(sn)</div></div><div><br/></div><div><br/></div><div>当当网络：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import requests</div><div>from lxml import html</div><div><br/></div><div>def spider(sn, book_list=[]):</div><div>    &quot;&quot;&quot; 爬取当当网的数据 &quot;&quot;&quot;</div><div>    url = 'http://search.dangdang.com/?key={sn}&amp;act=input'.format(sn=sn)</div><div>    # 获取html内容</div><div>    html_data = requests.get(url).text</div><div><br/></div><div>    # xpath对象</div><div>    selector = html.fromstring(html_data)</div><div><br/></div><div>    # 找到书本列表</div><div>    ul_list = selector.xpath('//div[@id=&quot;search_nature_rg&quot;]/ul/li')</div><div>    print(len(ul_list))</div><div>    for li in ul_list:</div><div>        # 标题</div><div>        title = li.xpath('a/@title')</div><div>        print(title[0])</div><div>        # 购买链接</div><div>        link = li.xpath('a/@href')</div><div>        print(link[0])</div><div>        # 价格</div><div>        price = li.xpath('p[@class=&quot;price&quot;]/span[@class=&quot;search_now_price&quot;]/text()')</div><div>        print(price[0].replace('¥', ''))</div><div><br/></div><div>        # 商家</div><div>        store = li.xpath('p[@class=&quot;search_shangjia&quot;]/a/text()')</div><div>        store = '当当自营' if len(store) == 0 else store[0]</div><div>        print(store)</div><div>        print('-----------------------')</div><div><br/></div><div>        book_list.append({</div><div>            'title': title[0],</div><div>            'price': price[0].replace('¥', ''),</div><div>            'link': link[0],</div><div>            'store': store[0]</div><div>        })</div><div><br/></div><div><br/></div><div>if __name__ == '__main__':</div><div>    </div><div>    sn = '9787115428028'</div><div>    spider(sn)</div></div><div><br/></div><div><br/></div><div>京东</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import requests</div><div>from lxml import html</div><div><br/></div><div><br/></div><div>def spider(sn, book_list=[]):</div><div>    &quot;&quot;&quot; 爬取京东的图书数据 &quot;&quot;&quot;</div><div>    url = 'https://search.jd.com/Search?keyword={0}'.format(sn)</div><div>    # 获取HTML文档</div><div><br/></div><div>    resp = requests.get(url)</div><div>    print(resp.encoding)</div><div>    resp.encoding = 'utf-8'</div><div><br/></div><div>    html_doc = resp.text</div><div><br/></div><div>    # 获取xpath对象</div><div>    selector = html.fromstring(html_doc)</div><div><br/></div><div>    # 找到列表的集合</div><div>    ul_list = selector.xpath('//div[@id=&quot;J_goodsList&quot;]/ul/li')</div><div>    print(len(ul_list))</div><div><br/></div><div>    # 解析对应的内容，标题，价格，链接</div><div>    for li in ul_list:</div><div>        # 标题</div><div>        title = li.xpath('div/div[@class=&quot;p-name&quot;]/a/@title')</div><div>        print(title[0])</div><div>        # 购买链接</div><div>        link = li.xpath('div/div[@class=&quot;p-name&quot;]/a/@href')</div><div>        print(link[0])</div><div><br/></div><div>        # 价格</div><div>        price = li.xpath('div/div[@class=&quot;p-price&quot;]/strong/i/text()')</div><div>        print(price[0])</div><div><br/></div><div>        # 店铺</div><div>        store = li.xpath('div//a[@class=&quot;curr-shop&quot;]/@title')</div><div>        print(store[0])</div><div><br/></div><div>        book_list.append({</div><div>            'title': title[0],</div><div>            'price': price[0],</div><div>            'link': link[0],</div><div>            'store': store[0]</div><div>        })</div><div><br/></div><div><br/></div><div>if __name__ == '__main__':</div><div>    spider('9787115428028')</div></div><div><br/></div><div>一号点：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import requests</div><div>from lxml import html</div><div><br/></div><div><br/></div><div>def spider(sn, book_list=[]):</div><div>    &quot;&quot;&quot; 爬取1号店的图书数据 &quot;&quot;&quot;</div><div>    url = 'https://search.yhd.com/c0-0/k{0}/'.format(sn)</div><div>    # 获取到html源码</div><div>    html_doc = requests.get(url).text</div><div><br/></div><div>    # xpath对象</div><div>    selector = html.fromstring(html_doc)</div><div><br/></div><div>    # 书籍列表</div><div>    ul_list = selector.xpath('//div[@id=&quot;itemSearchList&quot;]/div')</div><div>    print(len(ul_list))</div><div><br/></div><div>    # 解析数据</div><div>    for li in ul_list:</div><div>        # 标题，不关注div下面还有多少个div，</div><div>        #使用的后面固定前面元素的方法。相当一种相对路径的查找方法</div><div>        title = li.xpath('div/p[@class=&quot;proName clearfix&quot;]/a/@title')</div><div>        print(title[0])</div><div>        # 价格</div><div>        price = li.xpath('div//p[@class=&quot;proPrice&quot;]/em/@yhdprice')</div><div>        print(price[0])</div><div>        # 购买链接</div><div>        link = li.xpath('div/p[@class=&quot;proName clearfix&quot;]/a/@href')</div><div>        print(link[0])</div><div>        # 店铺</div><div>        store = li.xpath('div/p[@class=&quot;storeName limit_width&quot;]/a/@title')</div><div>        print(store)</div><div><br/></div><div>        book_list.append({</div><div>            'title': title[0],</div><div>            'price': price[0],</div><div>            'link': link[0],</div><div>            'store': store[0]</div><div>        })</div><div><br/></div><div><br/></div><div><br/></div><div>if __name__ == '__main__':</div><div>    spider('9787115428028')</div></div><div><br/></div><div><br/></div><div>淘宝：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 